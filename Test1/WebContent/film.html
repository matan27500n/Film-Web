<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script type="text/javascript">
	var app = angular.module("filmApp", []);
	app.controller("filmServlet", function($scope, $http) {
		$scope.searchText = "";
		$http({
			url : "FilmServlet",
			method : "GET"
		}).then(function(response) {
			$scope.filmlist = response.data;
			console.log(response);

		}, function(response) {
			console.log(response);
		});
		$scope.search = function(item) {
			var id = item.film_id.toString();
			if (id.includes($scope.searchText)
					|| item.title.toLowerCase().includes(
							$scope.searchText.toLowerCase()) || item.description.toLowerCase().includes(
									$scope.searchText.toLowerCase()) || item.release_year.toString().includes($scope.searchText)
									|| item.rental_duration.toString().includes($scope.searchText)) {
				return true;
			}
			return false;
		}
	});
	cPrev = -1;
	function sortBy(c) {
	    rows = document.getElementById("sortable").rows.length; // num of rows
	    columns = document.getElementById("sortable").rows[0].cells.length; // num of columns
	    arrTable = [...Array(rows)].map(e => Array(columns)); // create an empty 2d array

	    for (ro=0; ro<rows; ro++) { // cycle through rows
	        for (co=0; co<columns; co++) { // cycle through columns
	            // assign the value in each row-column to a 2d array by row-column
	            arrTable[ro][co] = document.getElementById("sortable").rows[ro].cells[co].innerHTML;
	        }
	    }

	    th = arrTable.shift(); // remove the header row from the array, and save it
	    
	    if (c !== cPrev) { // different column is clicked, so sort by the new column
	        arrTable.sort(
	            function (a, b) {
	                if (a[c] === b[c]) {
	                    return 0;
	                } else {
	                    return (a[c] < b[c]) ? -1 : 1;
	                }
	            }
	        );
	    } else { // if the same column is clicked then reverse the array
	        arrTable.reverse();
	    }
	    
	    cPrev = c; // save in previous c

	    arrTable.unshift(th); // put the header back in to the array

	    // cycle through rows-columns placing values from the array back into the html table
	    for (ro=0; ro<rows; ro++) {
	        for (co=0; co<columns; co++) {
	            document.getElementById("sortable").rows[ro].cells[co].innerHTML = arrTable[ro][co];
	        }
	    }
	}
	
	function Pager(tableName, itemsPerPage) {
	    'use strict';

	    this.tableName = tableName;
	    this.itemsPerPage = itemsPerPage;
	    this.currentPage = 1;
	    this.pages = 0;
	    this.inited = false;

	    this.showRecords = function (from, to) {
	        let rows = document.getElementById(tableName).rows;

	        // i starts from 1 to skip table header row
	        for (let i = 1; i < rows.length; i++) {
	            if (i < from || i > to) {
	                rows[i].style.display = 'none';
	            } else {
	                rows[i].style.display = '';
	            }
	        }
	    };

	    function Pager(tableName, itemsPerPage) {
	        'use strict';

	        this.tableName = tableName;
	        this.itemsPerPage = itemsPerPage;
	        this.currentPage = 1;
	        this.pages = 0;
	        this.inited = false;

	        this.showRecords = function (from, to) {
	            let rows = document.getElementById(tableName).rows;

	            // i starts from 1 to skip table header row
	            for (let i = 1; i < rows.length; i++) {
	                if (i < from || i > to) {
	                    rows[i].style.display = 'none';
	                } else {
	                    rows[i].style.display = '';
	                }
	            }
	        };

	        this.showPage = function (pageNumber) {
	            if (!this.inited) {
	                // Not initialized
	                return;
	            }

	            let oldPageAnchor = document.getElementById('pg' + this.currentPage);
	            oldPageAnchor.className = 'pg-normal';

	            this.currentPage = pageNumber;
	            let newPageAnchor = document.getElementById('pg' + this.currentPage);
	            newPageAnchor.className = 'pg-selected';

	            let from = (pageNumber - 1) * itemsPerPage + 1;
	            let to = from + itemsPerPage - 1;
	            this.showRecords(from, to);

	            let pgNext = document.querySelector('.pg-next'),
	                pgPrev = document.querySelector('.pg-prev');

	            if (this.currentPage == this.pages) {
	                pgNext.style.display = 'none';
	            } else {
	                pgNext.style.display = '';
	            }

	            if (this.currentPage === 1) {
	                pgPrev.style.display = 'none';
	            } else {
	                pgPrev.style.display = '';
	            }
	        };

	        this.prev = function () {
	            if (this.currentPage > 1) {
	                this.showPage(this.currentPage - 1);
	            }
	        };

	        this.next = function () {
	            if (this.currentPage < this.pages) {
	                this.showPage(this.currentPage + 1);
	            }
	        };

	        this.init = function () {
	            let rows = document.getElementById(tableName).rows;
	            let records = (rows.length - 1);

	            this.pages = Math.ceil(records / itemsPerPage);
	            this.inited = true;
	        };

	        this.showPageNav = function (pagerName, positionId) {
	            if (!this.inited) {
	                // Not initialized
	                return;
	            }

	            let element = document.getElementById(positionId),
	                pagerHtml = '<span onclick="' + pagerName + '.prev();" class="pg-normal pg-prev">«</span>';

	            for (let page = 1; page <= this.pages; page++) {
	                pagerHtml += '<span id="pg' + page + '" class="pg-normal pg-next" onclick="' + pagerName + '.showPage(' + page + ');">' + page + '</span>';
	            }

	            pagerHtml += '<span onclick="' + pagerName + '.next();" class="pg-normal">»</span>';

	            element.innerHTML = pagerHtml;
	        };
	    }
</script>
<style type="text/css">
table {
	width: 100%;
	border-collapse: collapse;
}

table td, th {
	border: 1px solid #00061a;
}

table td {
	text-align: center
}

th {
	cursor: pointer;
}
</style>
</head>
<body data-ng-app="filmApp" data-ng-controller="filmServlet">
	<div>
		<h1 align="center">Table Films</h1>
		<hr>
		<a href="filmForm.html" class="btn btn-info" role="button">Add New
			Film</a> <input type="text" data-ng-model="searchText"
			placeholder="Search" class="form-control" />
		<table id="sortable">
			<tr>
				<th onclick="sortBy(0)">ID</th>
				<th onclick="sortBy(1)">Title</th>
				<th onclick="sortBy(2)">Description</th>
				<th onclick="sortBy(3)">Release Year</th>
				<th onclick="sortBy(4)">Language Id</th>
				<th onclick="sortBy(5)">Original Language Id</th>
				<th onclick="sortBy(6)">Rental Duration</th>
				<th onclick="sortBy(7)">Rental Rate</th>
				<th onclick="sortBy(8)">Length</th>
				<th onclick="sortBy(9)">Replacement Cost</th>
				<th onclick="sortBy(10)">Rating</th>
				<th onclick="sortBy(11)">Special Features</th>
				<th onclick="sortBy(12)">Last Update</th>
				<th>Actions</th>
			</tr>
			<tr data-ng-repeat="item in filmlist | filter:search">
				<td>{{item.film_id}}</td>
				<td>{{item.title}}</td>
				<td>{{item.description}}</td>
				<td>{{item.release_year}}</td>
				<td>{{item.language_id}}</td>
				<td>{{item.original_language_id}}</td>
				<td>{{item.rental_duration}}</td>
				<td>{{item.rental_rate}}</td>
				<td>{{item.length}}</td>
				<td>{{item.replacement_cost}}</td>
				<td>{{item.rating}}</td>
				<td>{{item.special_features}}</td>
				<td>{{item.last_update}}</td>
				<td><a href="UpdateServlet?film_id={{item.film_id}}"
					class="btn btn-warning" role="button">Update</a> <a
					href="DeleteServlet?film_id={{item.film_id}}"
					class="btn btn-danger" role="button">Delete</a>
			</tr>
		</table>
	</div>
</body>
</html>